
import java.io.UnsupportedEncodingException;
import java.util.ArrayList;


public class VulnSeeker extends HttpCrawler{
    public VulnSeeker() {
        super();
        this.addHeader("User-Agent", "Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:66.0) Gecko/20100101 Firefox/66.0");
    }
    
    public boolean isVulnerable(String url) throws UnsupportedEncodingException {
        Response res;
        String url_with_params = RegEx.match("(.+\\?.+=)", url);
        
        if(url_with_params != null)
            res = this.get(url_with_params+"%27");
        else
            res = this.get(url+"?id=%27");
        
        if(RegEx.match("(SQL)", res.body) != null)
            return true;
        
        return false;
    }
    
    public String[] findVulnerables(String[] urls) throws UnsupportedEncodingException {
        ArrayList<String> vulnerables = new ArrayList<String>();
        
        for(int i = 0; i < urls.length; i++) {
            if(isVulnerable(urls[i]))
                vulnerables.add(urls[i]);
        }
        
        String[] vulnerablesArray = new String[vulnerables.size()];
        
        for(int i = 0; i < vulnerablesArray.length; i++) {
            vulnerablesArray[i] = vulnerables.get(i);
        }
        
        return vulnerablesArray;
    }
}
